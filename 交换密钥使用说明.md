# RSA 交换公钥使用说明

## ?? 场景说明

当您想要给别人发送加密消息时，需要获取对方的**公钥**。本系统支持导入他人的公钥进行加密。

## ? 使用流程

### 发送方（小明）的操作

1. **生成自己的密钥对**
   ```
   选择菜单：1. 生成新的RSA密钥对
   选择安全级别：2（推荐）
   ```

2. **分享公钥给接收方**
   - 将生成的 `public_key.txt` 文件发送给小红
   - ?? 注意：只发送 `public_key.txt`，不要发送 `private_key.txt`！

3. **接收方的公钥**
   - 从小红那里收到她的 `public_key.txt`
   - 保存为 `xiaohong_public_key.txt`（或其他文件名）

4. **导入对方公钥**
   ```
   选择菜单：6. 导入他人公钥（仅用于加密）
   输入文件名：xiaohong_public_key.txt
   ```

5. **使用对方公钥加密消息**
   ```
   选择菜单：2. 加密文本
   输入要发送的消息
   ```

6. **发送密文**
   - 将加密后的数字序列发送给小红

### 接收方（小红）的操作

1. **使用自己的私钥解密**
   ```
   选择菜单：3. 解密文本
   粘贴收到的密文
   ```

## ?? 完整示例

### 场景：小明给小红发送加密消息 "Hello"

**小明的操作：**
```
步骤1：生成自己的密钥对（安全级别2）
  - 生成文件：xiaoming_public_key.txt, xiaoming_private_key.txt

步骤2：将 xiaoming_public_key.txt 发给小红

步骤3：收到小红的 xiaohong_public_key.txt

步骤4：导入小红的公钥
  菜单选择 6 -> 输入：xiaohong_public_key.txt
  ? 公钥导入成功！

步骤5：加密消息
  菜单选择 2 -> 输入：Hello
  得到密文：72158 101234 108567 108567 111890

步骤6：将密文发给小红
```

**小红的操作：**
```
步骤1：已有自己的密钥对（xiaohong_private_key.txt）

步骤2：接收小明的密文

步骤3：解密消息
  菜单选择 3 -> 输入：72158 101234 108567 108567 111890
  ? 解密成功！
  解密后的文本：Hello
```

## ?? 重要说明

### 密钥匹配问题

**问题：** 为什么交换公钥后，选择"5. 重新加载密钥"会失败？

**原因：** `loadKeys()` 函数会验证 `public_key.txt` 和 `private_key.txt` 中的模数 `n` 是否匹配。如果公钥来自他人，这两个 `n` 值不同，加载会失败。

**解决方案：**
- 使用 **菜单选项 6**："导入他人公钥（仅用于加密）"
- 这个选项只加载公钥，不检查私钥匹配

### 安全最佳实践

1. **永远不要分享私钥**
   - ? 不要把 `private_key.txt` 发给任何人
   - ? 只分享 `public_key.txt`

2. **妥善保管私钥**
   - 将 `private_key.txt` 保存在安全位置
   - 定期备份到加密的U盘或云存储

3. **验证公钥来源**
   - 确认收到的公钥确实来自对方
   - 可以通过其他安全渠道（如电话）核实

4. **密钥文件管理**
   - 建议给导入的公钥重命名，如：`张三_public_key.txt`
   - 保持自己的密钥对文件名为默认的 `public_key.txt` 和 `private_key.txt`

## ?? 工作流程图

```
小明                                小红
 |                                   |
 |--[1] 生成密钥对                    |--[1] 生成密钥对
 |    xiaoming_public_key.txt        |    xiaohong_public_key.txt
 |    xiaoming_private_key.txt       |    xiaohong_private_key.txt
 |                                   |
 |--[2] 发送公钥---------------->    |
 |    xiaoming_public_key.txt        |
 |                                   |
 |    <------------------[3] 发送公钥--|
 |                 xiaohong_public_key.txt
 |                                   |
 |--[4] 导入小红公钥                  |
 |    (菜单选项6)                     |
 |                                   |
 |--[5] 用小红公钥加密消息             |
 |    "Hello" -> 密文                 |
 |                                   |
 |--[6] 发送密文---------------->    |
 |    72158 101234 ...               |
 |                                   |
 |                                   |--[7] 用自己私钥解密
 |                                   |    密文 -> "Hello"
```

## ?? 常见问题

**Q1: 如何同时与多个人通信？**
A: 为每个人保存单独的公钥文件，加密前导入对应的公钥。

**Q2: 导入公钥后还能解密自己的消息吗？**
A: 可以！导入公钥只是临时用于加密。您的私钥仍然保存在系统中，可以随时解密发给您的消息。

**Q3: 如何切换回使用自己的密钥对？**
A: 选择菜单选项 5："重新加载密钥"，系统会重新加载您的完整密钥对。

**Q4: 可以用导入的公钥解密吗？**
A: 不可以！公钥只能用于加密，解密需要对应的私钥。

## ?? 菜单选项对比

| 选项 | 功能 | 适用场景 |
|-----|------|---------|
| 5. 重新加载密钥 | 加载完整密钥对<br>（公钥+私钥必须匹配） | 使用自己的密钥对 |
| 6. 导入他人公钥 | 只加载公钥<br>（不检查私钥） | 给他人发送加密消息 |

## ? 快速检查清单

发送加密消息前：
- [ ] 已收到对方的公钥文件
- [ ] 使用菜单选项 6 导入公钥
- [ ] 看到"? 公钥导入成功"提示
- [ ] 使用菜单选项 2 加密消息
- [ ] 将密文（数字序列）发送给对方

接收加密消息时：
- [ ] 确保自己的私钥文件完整
- [ ] 使用菜单选项 5 加载自己的密钥对
- [ ] 使用菜单选项 3 解密消息
